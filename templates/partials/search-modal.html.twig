<div id="navSearchModal" class="fixed inset-0 z-[9999] hidden">
	<div id="navSearchOverlay" class="absolute inset-0 bg-black/40 backdrop-blur-[2px]"></div>

	<div class="relative h-full w-full flex items-center justify-center p-4">
		<div id="navSearchDialog" class="w-full max-w-2xl rounded-3xl bg-white shadow-2xl ring-1 ring-black/5 p-5 sm:p-6 opacity-0 translate-y-3 scale-[0.98] transition-all duration-200 ease-out">
			<div class="flex items-start justify-between gap-3 mb-6">
				<div>
					<p id="navSearchTitle" class="text-lg sm:text-2xl font-semibold text-slate-900">Wyszukiwarka</p>
				</div>

				<button type="button" id="navSearchClose" class="inline-flex items-center justify-center rounded-xl px-3 py-2 text-slate-600 hover:bg-slate-100 transition">
					<i class="fa-solid fa-xmark"></i>
				</button>
			</div>

			<form action="{{ path('app_search') }}" method="get" class="home__search w-full">
				<div class="flex flex-col sm:flex-row sm:items-center gap-3 rounded-2xl bg-slate-50 px-4 py-3 ring-1 ring-slate-200">
					<div class="flex items-center gap-3 w-full">
						<i class="fa-solid fa-magnifying-glass text-slate-500"></i>
						<input id="navSearchInput" type="text" name="q" placeholder="Szukaj usług lub biznesów..." class="w-full bg-transparent outline-none text-slate-900 placeholder:text-slate-500" autocomplete="off">
					</div>

					<button type="submit" id="navSearchSubmit" class="inline-flex w-full sm:w-auto items-center justify-center px-6 py-2 font-semibold text-white bg-[color:var(--c-cta)] hover:brightness-95 transition rounded-xl">
						Szukaj
					</button>
				</div>
			</form>
		</div>
	</div>
</div>

{% block custom_scripts %}

	<script defer>

		document.addEventListener('DOMContentLoaded', () => {
            
			const toggle = document.getElementById('navSearchToggle');
			const modal = document.getElementById('navSearchModal');
			const overlay = document.getElementById('navSearchOverlay');
			const closeBtn = document.getElementById('navSearchClose');
			const dialog = document.getElementById('navSearchDialog');

			const input = document.getElementById('navSearchInput');
            const submitBtn = document.getElementById('navSearchSubmit');

			if (!toggle || !modal || !overlay || !dialog) return;

            submitBtn.addEventListener('click', (e) => {
                if (input.value.length == 0) {
                    e.preventDefault();
                }
            });

			let lastActiveEl = null;

			const open = () => {
				lastActiveEl = document.activeElement;
				modal.classList.remove('hidden');
				modal.classList.add('is-open');
				document.body.classList.add('is-modal-open');
				window.setTimeout(() => input?.focus(), 50);
			};

			const close = () => {
				modal.classList.remove('is-open');
				document.body.classList.remove('is-modal-open');

				window.setTimeout(() => {
					modal.classList.add('hidden');
					if (lastActiveEl && typeof lastActiveEl.focus === 'function') lastActiveEl.focus();
				}, 200);
			};

			const isOpen = () => modal.classList.contains('is-open');

			toggle.addEventListener('click', (e) => {
				e.preventDefault();
				isOpen() ? close() : open();
			});

			closeBtn.addEventListener('click', (e) => {
				e.preventDefault();
				close();
			});

			overlay.addEventListener('click', close);

			modal.addEventListener('click', (e) => {
				const t = e.target;
				if (!(t instanceof Element)) return;
				if (!dialog.contains(t) && t !== toggle) close();
			});

		});

	</script>

{% endblock %}