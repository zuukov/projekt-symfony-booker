{% extends 'base.html.twig' %}

{% block title %}Usługi - {{ business.businessName }}{% endblock %}

{% block body %}
<div class="max-w-7xl mx-auto px-4 mt-8 pt-4 pb-14">
    <div class="w-full">
        <nav class="mb-6" aria-label="breadcrumb">
            <ol class="flex space-x-2 text-sm text-gray-600">
                <li><a href="{{ path('owner_dashboard') }}" class="hover:text-indigo-600">Panel właściciela</a></li>
                <li class="before:content-['/'] before:mx-2"><a href="{{ path('owner_business_staff', {id: business.id}) }}" class="hover:text-indigo-600">{{ business.businessName }}</a></li>
                <li class="before:content-['/'] before:mx-2 text-gray-900">Usługi</li>
            </ol>
        </nav>

        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
            <h1 class="text-3xl font-bold text-gray-900">Usługi</h1>
            <div class="flex gap-2">
                <a href="{{ path('owner_business_staff', {id: business.id}) }}" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">Powrót</a>
                <a href="{{ path('owner_service_create', {id: business.id}) }}" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Dodaj usługę</a>
            </div>
        </div>

        {% for message in app.flashes('success') %}
            <div class="p-4 mb-4 text-green-800 bg-green-100 border border-green-200 rounded-lg">{{ message }}</div>
        {% endfor %}

        {% for message in app.flashes('error') %}
            <div class="p-4 mb-4 text-red-800 bg-red-100 border border-red-200 rounded-lg">{{ message }}</div>
        {% endfor %}

        {% if services is empty %}
            <div class="p-4 mb-4 text-blue-800 bg-blue-100 border border-blue-200 rounded-lg">
                Nie masz jeszcze żadnych usług. <a href="{{ path('owner_service_create', {id: business.id}) }}" class="underline hover:text-blue-900">Dodaj pierwszą usługę</a>.
            </div>
        {% else %}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for service in services %}
                    <div class="bg-white rounded-lg shadow flex flex-col h-full">
                        {% if service.featuredImage %}
                            <img src="{{ service.featuredImage }}" class="w-full h-48 object-cover rounded-t-lg" alt="{{ service.name }}">
                        {% else %}
                            <div class="w-full h-48 bg-gradient-to-br from-indigo-100 to-indigo-200 rounded-t-lg flex items-center justify-center">
                                <i class="fas fa-scissors fa-4x text-indigo-400"></i>
                            </div>
                        {% endif %}

                        <div class="p-6 flex-grow">
                            <div class="flex items-start justify-between mb-2">
                                <h5 class="text-lg font-semibold text-gray-900">{{ service.name }}</h5>
                                {% if service.isActive %}
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Aktywna</span>
                                {% else %}
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">Nieaktywna</span>
                                {% endif %}
                            </div>

                            <p class="text-sm text-gray-600 mb-3">{{ service.category.categoryFriendlyName }}</p>

                            {% if service.description %}
                                <p class="text-sm text-gray-700 mb-4">
                                    {{ service.description|slice(0, 100) }}{% if service.description|length > 100 %}...{% endif %}
                                </p>
                            {% endif %}

                            <div class="flex gap-2 mb-2">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                    <i class="fas fa-clock"></i> {{ service.durationMinutes }} min
                                </span>
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                    <i class="fas fa-money-bill"></i> {{ service.price }} PLN
                                </span>
                            </div>
                        </div>

                        <div class="border-t border-gray-200 p-4 flex gap-2">
                            <a href="{{ path('owner_service_edit', {businessId: business.id, serviceId: service.id}) }}" class="flex-1 px-4 py-2 text-center bg-white border border-indigo-600 text-indigo-600 rounded-md hover:bg-indigo-50">Edytuj</a>
                            <form method="post" action="{{ path('owner_service_delete', {businessId: business.id, serviceId: service.id}) }}" onsubmit="return confirm('Czy na pewno chcesz usunąć tę usługę?')" class="flex-1">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ service.id) }}">
                                <button type="submit" class="w-full px-4 py-2 border border-red-600 text-red-600 rounded-md hover:bg-red-50">Usuń</button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
