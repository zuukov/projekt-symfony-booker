{% extends 'base.html.twig' %}

{% block title %}Zarządzanie Personelem - {{ business.businessName }}{% endblock %}

{% block body %}
<div class="max-w-7xl mx-auto px-4 mt-8 pt-6 pb-20">
    <div class="w-full">
        <nav class="mb-6" aria-label="breadcrumb">
            <ol class="flex space-x-2 text-sm text-gray-600">
                <li><a href="{{ path('owner_dashboard') }}" class="hover:text-indigo-600">Panel właściciela</a></li>
                <li class="before:content-['/'] before:mx-2 text-gray-900">{{ business.businessName }}</li>
            </ol>
        </nav>

        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
            <h1 class="text-3xl font-bold text-gray-900">Zarządzanie Personelem - {{ business.businessName }}</h1>
            <div class="flex flex-wrap gap-2">
                <a href="{{ path('owner_services', {id: business.id}) }}" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">Usługi</a>
                <a href="{{ path('owner_calendar', {id: business.id}) }}" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700">Kalendarz</a>
                <a href="{{ path('owner_bookings', {id: business.id}) }}" class="px-4 py-2 bg-cyan-600 text-white rounded-md hover:bg-cyan-700">Rezerwacje</a>
                <a href="{{ path('owner_business_edit', {id: business.id}) }}" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">Edytuj Biznes</a>
                <a href="{{ path('owner_staff_create', {id: business.id}) }}" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Dodaj Pracownika</a>
            </div>
        </div>

        {% for message in app.flashes('success') %}
            <div class="p-4 mb-4 text-green-800 bg-green-100 border border-green-200 rounded-lg">{{ message }}</div>
        {% endfor %}

        {% if staff is empty %}
            <div class="p-4 mb-4 text-blue-800 bg-blue-100 border border-blue-200 rounded-lg">
                Nie dodano jeszcze żadnych pracowników.
                <a href="{{ path('owner_staff_create', {id: business.id}) }}" class="underline hover:text-blue-900">Dodaj swojego pierwszego pracownika</a>.
            </div>
        {% else %}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for staffMember in staff %}
                    <div class="bg-white rounded-lg shadow flex flex-col h-full">
                        <div class="p-6 flex-grow">
                            {% if staffMember.avatarImage %}
                                <img src="{{ staffMember.avatarImage }}" class="rounded-full mx-auto block" alt="Avatar" style="width: 80px; height: 80px; object-fit: cover;">
                            {% else %}
                                <div class="bg-gray-100 rounded-full mx-auto flex items-center justify-center" style="width: 80px; height: 80px;">
                                    <i class="fas fa-user fa-2x text-gray-400"></i>
                                </div>
                            {% endif %}
                            <h5 class="text-lg font-semibold text-center mt-3">{{ staffMember.name }} {{ staffMember.surname }}</h5>
                            {% if staffMember.aboutMe %}
                                <p class="text-gray-600 mt-2">{{ staffMember.aboutMe|slice(0, 100) }}{% if staffMember.aboutMe|length > 100 %}...{% endif %}</p>
                            {% endif %}
                            {% if staffMember.school %}
                                <p class="text-sm text-gray-500 mt-2">
                                    Wykształcenie: {{ staffMember.school }}
                                </p>
                            {% endif %}
                        </div>
                        <div class="border-t border-gray-200 p-4">
                            <div class="space-y-2">
                                <div class="grid grid-cols-4 gap-2">
                                    <a href="{{ path('owner_staff_services', {id: business.id, staffId: staffMember.id}) }}" class="px-2 py-1 text-xs text-center border border-cyan-600 text-cyan-600 rounded hover:bg-cyan-50">Usługi</a>
                                    <a href="{{ path('owner_staff_schedule', {id: business.id, staffId: staffMember.id}) }}" class="px-2 py-1 text-xs text-center border border-green-600 text-green-600 rounded hover:bg-green-50">Grafik</a>
                                    <a href="{{ path('owner_staff_timeoff', {id: business.id, staffId: staffMember.id}) }}" class="px-2 py-1 text-xs text-center border border-yellow-600 text-yellow-600 rounded hover:bg-yellow-50">Urlopy</a>
                                    <a href="{{ path('owner_staff_edit', {businessId: business.id, staffId: staffMember.id}) }}" class="px-2 py-1 text-xs text-center border border-indigo-600 text-indigo-600 rounded hover:bg-indigo-50">Edytuj</a>
                                </div>
                                <form method="post" action="{{ path('owner_staff_delete', {businessId: business.id, staffId: staffMember.id}) }}"
                                      onsubmit="return confirm('Czy na pewno chcesz usunąć tego pracownika?')">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ staffMember.id) }}">
                                    <button type="submit" class="w-full px-2 py-1 text-xs border border-red-600 text-red-600 rounded hover:bg-red-50">Usuń</button>
                                </form>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
