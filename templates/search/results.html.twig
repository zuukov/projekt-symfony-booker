{% extends 'base.html.twig' %}

{% block title %}Booker - szukaj: {{ q }}{% endblock %}

{% block header %}
    {% include 'partials/header-alt.html.twig' %}
{% endblock %}

{% block body %}
    <div class="mx-auto w-[min(1100px,92%)] py-10 min-h-[80vh]">
        <h1 class="text-3xl font-semibold text-slate-900">Wyniki dla: {{ q }}</h1>
        <p class="mt-2 text-slate-600">Znaleziono: {{ total }} wynik(ów)</p>

        {% if total == 0 %}
            <div class="mt-8 rounded-2xl bg-slate-50 p-6 text-slate-700">
                Brak wyników. Spróbuj innej frazy.
            </div>
        {% else %}
            {% if businesses is not empty %}
                <div class="mt-8">
                    <h2 class="text-2xl font-semibold text-slate-900 mb-4">Firmy ({{ businesses|length }})</h2>
                    <div class="grid gap-4 sm:grid-cols-2">
                        {% for business in businesses %}
                            <article class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm hover:shadow-md transition">
                                <h3 class="text-lg font-semibold text-slate-900">{{ business.businessName }}</h3>
                                <div class="mt-2 text-sm text-slate-600">
                                    <i class="fas fa-map-marker-alt"></i> {{ business.city }}, {{ business.address }}
                                </div>
                                {% if business.description %}
                                    <p class="mt-2 text-sm text-slate-700">
                                        {{ business.description|slice(0, 120) }}{% if business.description|length > 120 %}...{% endif %}
                                    </p>
                                {% endif %}
                                <div class="mt-3">
                                    <a href="{{ path('business_index', {id: business.id}) }}" class="text-sm text-indigo-600 hover:text-indigo-800 font-medium">
                                        Zobacz szczegóły <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                            </article>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            {% if services is not empty %}
                <div class="mt-8">
                    <h2 class="text-2xl font-semibold text-slate-900 mb-4">Usługi ({{ services|length }})</h2>
                    <div class="grid gap-4 sm:grid-cols-2">
                        {% for service in services %}
                            <article class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm hover:shadow-md transition">
                                <h3 class="text-lg font-semibold text-slate-900">{{ service.name }}</h3>
                                <p class="text-sm text-slate-600 mt-1">{{ service.business.businessName }}</p>
                                <div class="mt-2 text-sm text-slate-700">
                                    <span class="inline-block px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                        <i class="fas fa-clock"></i> {{ service.durationMinutes }} min
                                    </span>
                                    <span class="inline-block px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 ml-2">
                                        <i class="fas fa-money-bill"></i> {{ service.price }} PLN
                                    </span>
                                </div>
                                {% if service.description %}
                                    <p class="mt-2 text-sm text-slate-700">
                                        {{ service.description|slice(0, 100) }}{% if service.description|length > 100 %}...{% endif %}
                                    </p>
                                {% endif %}
                                <div class="mt-3">
                                    <a href="{{ path('booking_select_staff', {businessId: service.business.id, serviceId: service.id}) }}" class="text-sm text-indigo-600 hover:text-indigo-800 font-medium">
                                        Rezerwuj <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                            </article>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            {% if staff is not empty %}
                <div class="mt-8">
                    <h2 class="text-2xl font-semibold text-slate-900 mb-4">Pracownicy ({{ staff|length }})</h2>
                    <div class="grid gap-4 sm:grid-cols-2">
                        {% for staffMember in staff %}
                            <article class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm hover:shadow-md transition">
                                <div class="flex items-center gap-3">
                                    {% if staffMember.avatarImage %}
                                        <img src="{{ staffMember.avatarImage }}" class="rounded-full" alt="{{ staffMember.name }}" style="width: 50px; height: 50px; object-fit: cover;">
                                    {% else %}
                                        <div class="bg-slate-100 rounded-full flex items-center justify-center" style="width: 50px; height: 50px;">
                                            <i class="fas fa-user text-slate-400"></i>
                                        </div>
                                    {% endif %}
                                    <div>
                                        <h3 class="text-lg font-semibold text-slate-900">{{ staffMember.name }} {{ staffMember.surname }}</h3>
                                        <p class="text-sm text-slate-600">{{ staffMember.business.businessName }}</p>
                                    </div>
                                </div>
                                {% if staffMember.aboutMe %}
                                    <p class="mt-3 text-sm text-slate-700">
                                        {{ staffMember.aboutMe|slice(0, 100) }}{% if staffMember.aboutMe|length > 100 %}...{% endif %}
                                    </p>
                                {% endif %}
                                <div class="mt-3">
                                    <a href="{{ path('business_index', {id: staffMember.business.id}) }}" class="text-sm text-indigo-600 hover:text-indigo-800 font-medium">
                                        Zobacz firmę <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                            </article>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endif %}
    </div>
{% endblock %}
